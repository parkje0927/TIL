# 도메인 주도 개발 시작하기
> 도메인 주도 개발 시작하기 : DDD 핵심 개념 정리부터 구현까지 책 읽으면서 정리한 내용

## 1장 도메인 모델 시작하기
- 도메인 모델 : 도메인 계층의 객체 모델을 표현할 때 도메인 모델이라고 표현
- 엔티티
    - 식별자를 가진다. (ex - Order 클래스의 주문 번호)
    - 식별자는 변하지 않는다. 식별자가 같으면 두 엔티티는 같다고 판단할 수 있다.
- 밸류
    - 개념적으로 완전한 하나를 표현할 때 사용한다.
    - ex)
    ```java
    class Receiver {
        private String name;
        private String phoneNumber;
    }
    ```
    - 의미를 명확하게 표현하기 위해 밸류 타입을 사용하는 경우도 있다. 예를 들어 `int price;` 를 Money 라는 클래스를 생성하여 표현한다면 -> `Money price;` 라고 표현할 수 있고 이를 통해 의미가 더 분명해질 수 있다. 이렇게 Money 처럼 변경 기능 제공 X => 불변
    - 안전한 코드 작성을 위해 밸류 사용
    - 불변으로 구현
- 도메인 모델에 set 메소드 넣지 않기
    - 도메인의 핵심 개념이나 의도를 코드에서 사라지게 한다.
    - 도메인 객체를 생성할 때 온전하지 않은 상태가 될 수 있다. -> 생성자를 통해 필요한 데이터를 모두 받아야지 set 메소드를 사용하다가 특정 필드값이 설정되지 않은 상태로 만들어지면 X -> 생성자를 통해 생성자 호출 시점에 필요한 데이터가 올바른지 검사 가능
    - 추가) DTO 도 private 필드에 직접 값을 할당할 수 있어서 이 기능을 활용하는 것을 추천!
- 유비쿼터스 언어
    - 용어의 모호함을 줄일 수 있고, 개발자는 도메인과 코드 사이에서 불필요한 해석 과정을 줄일 수 있다.
    - 도메인 용어에 알맞은 단어를 찾는 시간을 아까워하지 말자!

## 2장 아키텍처 개요
### 아키텍처
- 표현 영역
    - 사용자의 요청을 해석해서 응용 서비스에 전달하고, 응용 서비스의 실행 결과를 사용자가 이해할 수 있는 형식으로 변환하여 응답한다.
- 응용 영역
    - 사용자의 요청을 전달받아서 시스템이 사용자에게 제공해야 할 기능을 구현
    - 도메인 로직 구현은 도메인 모델에 위임한다. ex) `order.cancel();``
- 도메인 영역
    - 도메인 모델을 구현
- 인프라스트럭처 영역
    - 구현 기술에 대한 것 => RDBMS 연동 처리, 메세지 큐, redis 연동 등
    - 논리적인 것보다는 실제 구현

### 계층 구조 아키텍처
- 표현, 응용 영역은 도메인 영역 사용
- 도메인 영역은 인프라스트럭처 영역 사용
- 계층 구조는 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않는다.
- 표현, 응용, 도메인 계층이 인프라스트럭처 계층에 종속 -> 테스트가 어렵고, 기능 확장의 어려움이 발생 -> 해결을 위해 DIP

### DIP(의존 역전 원칙)
- 지금까지는 고수준 모듈이 저수준 모듈에 의존하는 방법
- DIP 를 적용하면 저수준 모듈이 고수준 모듈에 의존해야한다. -> 추상 타입 사용, 추상화한 인터페이스
- CalculateDiscountService 라는 고수준 모듈에서는 RuleDiscounter(인터페이스/고수준 모듈) 를 주입받고, 이를 상속받아 구현한 저수준 모듈인 DroolsRuleDiscounter 가 존재
- 그러면 저수준 모듈이 고수준 모듈에 의존(상속은 의존의 다른 형태) -> 구현 교체가 어렵다는 것과 테스트가 어려운 문제를 해소할 수 있다.
- 실제 구현 없이 스텁이나 모의 객체와 같은 대역을 사용하여 테스트를 할 수 있다. 이유는 DIP 를 적용해서 고수준 모듈이 저수준 모듈에 의존하지 않도록 했기 때문
- DIP 를 적용할 때 하위 기능을 추상화한 인터페이스는 고수준 모듈 관점에서 도출 -> 하위 기능을 추상화한 인터페이스는 고수준 모듈에 위치

<br>

- 인프라스트럭처 영역 : 구현 기술을 다루는 저수준 모듈
- 응용, 도메인 영역 : 고수준 모듈
- 인프라스트럭처 영역이 응용 영역과 도메인 영역에 의존하는 구조가 된다.

<br>

- 인프라스트럭처에 위치한 클래스가 도메인이나 응용 영역에 정의한 인터페이스를 상속받아 구현하는 구조

### 도메인 영역의 주요 구성 요소
- 엔티티 : 고유의 식별자를 갖는 객체로 자신의 라이프 사이클을 갖는다.
- 밸류 : 고유의 식별자를 갖지 않는 객체, 주로 개념적으로 하나인 값을 표현할 때 사용
- 애그리거트 : 연관된 엔티티와 밸류를 하나로 묶은 것
- 리포지터리 : 도메인 모델의 영속성을 처리
- 도메인 서비스 : 특정 엔티티에 속하지 않은 도메인 로직을 제공